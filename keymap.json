[
  {
    "context": "Editor",
    "bindings": {
      // Editor navigation
      "cmd-h": "editor::MoveLeft",
      "cmd-j": "editor::MoveDown",
      "cmd-k": "editor::MoveUp",
      "cmd-l": "editor::MoveRight",
      "cmd-shift-e": "project_panel::ToggleFocus"
    }
  },

  {
    "context": "Terminal && terminal_vi_mode == insert",
    "bindings": {
      "jk": ["terminal::SendKeystroke", "escape"]
    }
  },

  {
    "context": "FileFinder || CommandPalette || ProjectSearch || Picker",
    "bindings": {
      // Menu navigation in finders
      "cmd-j": "menu::SelectNext",
      "cmd-k": "menu::SelectPrevious"
    }
  },
  {
    "context": "CompletionsMenu",
    "bindings": {
      // Code completion navigation
      "cmd-j": "menu::SelectNext",
      "cmd-k": "menu::SelectPrevious",
      "cmd-h": "menu::Cancel",
      "cmd-l": "menu::Confirm"
    }
  },
  {
    "context": "Editor && showing_completions",
    "bindings": {
      // Code completion when typing
      "cmd-j": "menu::SelectNext",
      "cmd-k": "menu::SelectPrevious",
      "cmd-h": "menu::Cancel",
      "cmd-l": "menu::Confirm"
    }
  },
  {
    "context": "menu",
    "bindings": {
      // General menu navigation
      "cmd-j": "menu::SelectNext",
      "cmd-k": "menu::SelectPrevious"
    }
  },

  {
    "context": "ProjectPanel && !editing",
    "bindings": {
      "h": "project_panel::CollapseSelectedEntry",
      "l": "project_panel::ExpandSelectedEntry",
      "j": "menu::SelectNext"
    }
  },
  {
    "context": "vim_mode == insert",
    "bindings": {
      "ctrl-x ctrl-o": "editor::ShowCompletions",
      "ctrl-x ctrl-a": "assistant::InlineAssist", // zed specific
      // For showing edit prediction manually.
      "ctrl-x ctrl-c": "editor::ShowEditPrediction",

      "j k": ["workspace::SendKeystrokes", "escape"]
    }
  },

  // {
  //   "context": "Workspace",
  //   "use_key_equivalents": true,
  //   "bindings": {
  //     "ctrl-w i": "terminal_panel::ToggleFocus",
  //     "ctrl-w p": "agent::ToggleFocus",
  //     "ctrl-w o": "project_panel::ToggleFocus",
  //     // Global navigation with cmd+hjkl (overrides arrow keys everywhere)
  //     "cmd-h": "editor::MoveLeft",
  //     "cmd-j": "editor::MoveDown",
  //     "cmd-k": "editor::MoveUp",
  //     "cmd-l": "editor::MoveRight"
  //   }
  // },
  {
    // really does anything. Duplicating the workspace panel focus works.
    "context": "(VimControl || (!Editor && !Terminal))",
    "use_key_equivalents": true,
    "bindings": {
      "ctrl-w p": "agent::ToggleFocus",
      "ctrl-w o": "project_panel::ToggleFocus"
    }
  },
  {
    "context": "VimControl && !menu",
    "bindings": {
      "g s": "outline::Toggle",
      "g i": "editor::ToggleCodeActions",
      // "g d": "editor::OpenExcerpts", // Moved to space g y
      "g c": ["editor::ToggleComments", { "advance_downwards": false }]
    }
  },
  {
    "context": "Editor && VimControl && !VimWaiting && !menu",
    "bindings": {
      "g l": "vim::SelectNext",
      "g L": "vim::SelectPrevious",
      "g a": "editor::SelectAllMatches",
      "g shift-ag": "editor::FindAllReferences",
      "g f": "project_symbols::Toggle"
    }
  },

  {
    "context": "Workspace",
    "bindings": {
      // "_": ["workspace::SendKeystrokes", "cmd-alt-c cmd-alt-w cmd-alt-x"],
      "alt--": ["workspace::SendKeystrokes", "cmd-alt-c cmd-alt-w cmd-alt-x"]
    }
  },

  {
    "context": "vim_mode == normal",
    "bindings": {
      "space -": ["workspace::SendKeystrokes", "cmd-alt-c cmd-alt-w cmd-alt-x"],

      // Buffer navigation (matching <S-h> and <S-l>)
      "shift-h": "pane::ActivatePreviousItem",
      "shift-l": "pane::ActivateNextItem",

      // Select all (Ctrl+A)
      "ctrl-a": "editor::SelectAll",

      // Undo/Redo (matching VS Code vim)
      "u": "editor::Undo",
      "U": "editor::Redo",

      // Window navigation
      "space h": "workspace::ActivatePaneLeft",
      "space j": "workspace::ActivatePaneDown",
      "space k": "workspace::ActivatePaneUp",
      "space l": "workspace::ActivatePaneRight",

      // Search and replace
      "/": "buffer_search::Deploy",

      // LSP keybindings (matching VS Code)
      "g d": "editor::GoToDefinition",
      "alt-shift-l": "editor::GoToDefinitionSplit",
      "alt-shift-h": ["workspace::SendKeystrokes", "g d cmd-shift-left"],

      "g f": "editor::Hover",
      "g i": "editor::GoToImplementation",
      "space g i": "editor::GoToImplementationSplit",
      "g r": "editor::FindAllReferences",
      "g t": "editor::GoToTypeDefinition",
      "g p t": "editor::GoToTypeDefinition",
      "g h": "editor::ToggleCodeActions",
      "space r": "editor::Rename",

      // Diagnostics navigation
      "'": "editor::GoToPreviousDiagnostic",
      ";": "editor::GoToNextDocumentHighlight",

      // Folding
      // "space f": "editor::Fold",

      // Diagnostics (matching Trouble)
      "space d": "diagnostics::Deploy",

      // Smart actions (toggle boolean)
      "space i": "editor::ToggleCodeActions",

      "cmd ]": "panel::NextPanelTab",
      "cmd [": "panel::PreviousPanelTab",

      // Terminal toggle

      // Buffers
      "space u": "pane::SplitRight",
      "space t": "pane::SplitDown",
      "cmd-[": "pane::ActivatePreviousItem",
      "cmd-]": "pane::ActivateNextItem",

      // Move active pane to adjacent split
      // "cmd-shift-left": "workspace::SwapPaneLeft",
      // "cmd-shift-right": "workspace::SwapPaneRight",
      // "cmd-shift-down": "workspace::SwapPaneDown",
      // "cmd-shift-up": "workspace::SwapPaneUp",
      "ctrl-w l": "workspace::ToggleRightDock",
      "ctrl-w h": "workspace::ToggleLeftDock",
      "ctrl-w j": "workspace::ToggleBottomDock",

      // Error navigation
      "[ e": "editor::GoToDiagnostic",
      "] e": "editor::GoToPreviousDiagnostic",

      "[ g": "editor::GoToHunk",
      "] g": "editor::GoToPreviousHunk",

      // MOVED HERE from global: avoid space listening in insert
      "space g y": "editor::OpenExcerpts"
    }
  },

  {
    "context": "Editor && vim_mode == normal && !menu",
    "bindings": {
      "cmd-shift-left": [
        "workspace::MoveItemToPaneInDirection",
        { "direction": "left" }
      ],
      "cmd-shift-w": "pane::CloseAllItems",
      "cmd-shift-right": [
        "workspace::MoveItemToPaneInDirection",
        { "direction": "right" }
      ],
      "cmd-shift-up": [
        "workspace::MoveItemToPaneInDirection",
        { "direction": "up" }
      ],
      "cmd-shift-down": [
        "workspace::MoveItemToPaneInDirection",
        { "direction": "down" }
      ]
    }
  },
  {
    "context": "EmptyPane || SharedScreen",
    "bindings": {
      // Key-bindings for empty pane
      "space p f": "file_finder::Toggle",
      "space f p": "projects::OpenRecent",
      "ctrl-w l": "workspace::ToggleRightDock"
    }
  },

  {
    "context": "FileFinder || CommandPalette || ProjectSearch || Picker",
    "bindings": {
      // Navigation in pickers and finders
      "cmd-j": "menu::SelectNext",
      "cmd-k": "menu::SelectPrevious"
    }
  },

  {
    "context": "Workspace",

    "use_key_equivalents": true,
    "bindings": {
      // Terminal and panel toggles
      "ctrl-\\": "terminal_panel::ToggleFocus",
      "ctrl-w i": "terminal_panel::ToggleFocus",
      "ctrl-w p": "agent::ToggleFocus",
      "ctrl-w o": "project_panel::ToggleFocus",
      // Tab navigation
      "cmd-]": "pane::ActivateNextItem",
      "cmd-[": "pane::ActivatePreviousItem"
    }
  },
  {
    "context": "(VimControl || (!Editor && !Terminal))",
    "use_key_equivalents": true,
    "bindings": {
      "ctrl-w i": "terminal_panel::ToggleFocus",
      "ctrl-w p": "agent::ToggleFocus",
      "ctrl-w o": "project_panel::ToggleFocus"
    }
  },
  {
    "context": "VimControl && !menu",
    "bindings": {
      "g s": "outline::Toggle"
    }
  },
  {
    "context": "Editor && VimControl && !VimWaiting && !menu",
    "bindings": {
      // Multi-cursor and selection
      "g l": "vim::SelectNext",
      "g shift-l": "vim::SelectPrevious",
      "g a": "editor::SelectAllMatches",
      "g shift-a": "editor::FindAllReferences"
    }
  },

  {
    "context": "Editor && vim_mode == normal && !VimWaiting && !menu",
    "bindings": {
      // Hover and formatting
      "space e": "workspace::ToggleLeftDock",
      "space f": "editor::Format",

      // Window management
      "ctrl-w l": "workspace::ToggleRightDock",
      "ctrl-w h": "workspace::ToggleLeftDock",
      "ctrl-w j": "workspace::ToggleBottomDock"

      // Diagnostics navigation
      // "[ e": "editor::GoToPrevDiagnostic",
      // "] e": "editor::GoToNextDiagnostic",

      // Git hunks
      // "[ g": "editor::GoToPrevHunk",
      // "] g": "editor::GoToNextHunk"
    }
  },
  // {
  //   "context": "Terminal",
  //   "bindings": {
  //     "space t": "pane::SplitDown",
  //     "space u": "pane::SplitRight",
  //     "space h": "workspace::ActivatePaneLeft",
  //     "space j": "workspace::ActivatePaneDown",
  //     "space k": "workspace::ActivatePaneUp",
  //     "space l": "workspace::ActivatePaneRight"
  //   }
  // },

  {
    "context": "Terminal",
    "bindings": {
      "cmd-t": "terminal_panel::Toggle",
      "ctrl-w k": "terminal_panel::ToggleFocus",
      "alt-shift-j": "pane::SplitDown",
      "alt-shift-l": "pane::SplitRight",
      "alt-shift-h": "pane::SplitLeft",
      "alt-shift-k": "pane::SplitUp"
    }
  },
  {
    "context": "Workspace",
    "bindings": {
      "cmd-shift-w": "pane::CloseAllItems",
      "cmd-t": "terminal_panel::ToggleFocus"
    }
  },
  {
    "context": "!ContextEditor > (Editor && mode == full)",
    "bindings": {
      "cmd-shift-e": null
    }
  },
  {
    "context": "AgentPanel",
    "bindings": {
      "cmd-shift-e": null
    }
  },
  {
    "context": "Workspace",
    "bindings": {
      "cmd-shift-e": null
    }
  },
  {
    "context": "Workspace",
    "bindings": {
      "alt-t": "project_symbols::Toggle"
    }
  },

  // REMOVED (to prevent insert-mode space listening):
  // {
  //   "context": "Workspace",
  //   "bindings": {
  //     "space g d": "editor::GoToDefinitionSplit"
  //   }
  // },
  // {
  //   "context": "Workspace",
  //   "bindings": {
  //     "space g t": "editor::GoToTypeDefinitionSplit"
  //   }
  // },
  // {
  //   "bindings": {
  //     "space g y": "editor::OpenExcerpts"
  //   }
  // },

  {
    "context": "vim_mode == normal",
    "bindings": {
      "space m b": "vim::ToggleMarksView"
    }
  },
  {
    "context": "Pane",
    "bindings": {
      "cmd-shift-g": null
    }
  },
  {
    "context": "ContextEditor > Editor",
    "bindings": {
      "cmd-shift-g": null
    }
  },
  {
    "bindings": {
      "cmd-shift-g": "git_panel::ToggleFocus"
    }
  },
  {
    "context": "(ProjectPanel && not_editing)",
    "bindings": {
      "cmd-d": "project_panel::NewDirectory"
    }
  },
  {
    "context": "(ProjectPanel && not_editing)",
    "bindings": {
      "r": "project_panel::Rename"
    }
  },
  {
    "context": "(ProjectPanel && not_editing)",
    "bindings": {
      "n": "project_panel::NewFile"
    }
  },
  {
    "context": "(ProjectPanel && not_editing)",
    "bindings": {
      "%": null
    }
  },
  {
    "context": "ProjectPanel",
    "bindings": {
      "cmd-n": null
    }
  }
]
